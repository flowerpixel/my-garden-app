<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå± Sprout's Garden</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #aea4fc 0%, #ebd7fc 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            background: white;
            overflow: hidden;
            box-shadow: none;
            display: flex;
            border-radius: 0;
        }
        
        .sidebar {
            width: 160px;
            background: linear-gradient(135deg, #aea4fc 0%, #ebd7fc 100%);
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, #9a8dfc, #c8b5fc);
            color: white;
            padding: 15px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 16px;
            margin-bottom: 3px;
        }
        
        .nav {
            display: flex;
            flex-direction: column;
            background: transparent;
            padding: 5px 0;
            flex: 1;
        }
        
        .nav-item {
            width: 100%;
            padding: 12px 15px;
            text-align: left;
            background: none;
            border: none;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            color: #4a4a4a;
        }
        
        .nav-item.active {
            background: rgba(255,255,255,0.3);
            color: #333;
            border-right: 4px solid #4CAF50;
            font-weight: 600;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .content {
            padding: 15px;
            height: 100vh;
            flex: 1;
            overflow-y: auto;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: #f8f9fa;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
            background: white;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .plant-card {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #4CAF50;
        }
        
        .plant-card h3 {
            margin-bottom: 6px;
            color: #333;
            font-size: 15px;
        }
        
        .plant-card p {
            color: #666;
            font-size: 13px;
            margin-bottom: 3px;
        }
        
        .badges {
            margin-top: 6px;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 6px;
            background: #e9ecef;
            color: #495057;
            border-radius: 6px;
            font-size: 11px;
            margin-right: 4px;
            margin-top: 3px;
        }
        
        .badge.edible {
            background: #d4edda;
            color: #155724;
        }
        
        .badge.flowering {
            background: #fce4ec;
            color: #880e4f;
        }
        
        .result {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .setup-form {
            background: #fff3cd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #ffeaa7;
        }
        
        .setup-form h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .setup-form p {
            font-size: 12px;
            color: #856404;
            margin-bottom: 10px;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .quick-btn {
            padding: 10px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-btn:hover {
            border-color: #4CAF50;
            background: #f8fff9;
        }
        
        h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="header">
                <h1>üå± Sprout's Garden</h1>
            </div>
            
            <div class="nav">
                <button class="nav-item active" onclick="showSection('add')">üå± Add Plant</button>
                <button class="nav-item" onclick="showSection('varieties')">üåø Varieties</button>
                <button class="nav-item" onclick="showSection('view')">üëÅÔ∏è View</button>
                <button class="nav-item" onclick="showSection('setup')">‚öôÔ∏è Setup</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="content">
                <!-- Setup Section -->
                <div id="setup" class="section">
                    <div class="setup-form">
                        <h3>üîß Database Connection</h3>
                        <p>Enter your Supabase credentials:</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="supabaseUrl">Supabase URL</label>
                        <input type="url" id="supabaseUrl" placeholder="https://your-project.supabase.co" 
                               value="https://gztgrmgspbaurpyvrweq.supabase.co">
                    </div>
                    
                    <div class="form-group">
                        <label for="supabaseKey">API Key</label>
                        <input type="password" id="supabaseKey" placeholder="Your anon/public key">
                    </div>
                    
                    <button class="btn" onclick="saveCredentials()">üíæ Save & Test Connection</button>
                    
                    <div id="setupResult"></div>
                </div>
                
                <!-- Add Plant Section -->
                <div id="add" class="section active">
                    <h2>üå± Add New Plant</h2>
                    
                    <div class="form-group">
                        <label for="plantName">Plant Name</label>
                        <input type="text" id="plantName" placeholder="e.g., Tomato, Basil, Sunflower">
                    </div>
                    
                    <div class="form-group">
                        <label for="scientificName">Scientific Name (optional)</label>
                        <input type="text" id="scientificName" placeholder="e.g., Solanum lycopersicum">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isEdible" style="width: auto; margin-right: 8px;">
                            This plant is edible
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isFlowering" style="width: auto; margin-right: 8px;">
                            This plant flowers
                        </label>
                    </div>
                    
                    <button class="btn" onclick="addPlant()">üå± Add Plant</button>
                    
                    <div id="addResult"></div>
                </div>
                
                <!-- View Plants Section -->
                <div id="view" class="section">
                    <h2>üåø My Plants</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="loadPlants('all')">All Plants</button>
                        <button class="quick-btn" onclick="loadPlants('edible')">Edible</button>
                        <button class="quick-btn" onclick="loadPlants('flowering')">Flowering</button>
                        <button class="quick-btn" onclick="checkRawAPI()">Check API</button>
                    </div>
                    
                    <div id="plantsList"></div>
                </div>
                
                <!-- Varieties Section -->
                <div id="varieties" class="section">
                    <h2>üåø Plant Varieties</h2>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="loadPlantsForDropdowns()">Refresh Plants</button>
                        <button class="quick-btn" onclick="testConnection()">Test Connection</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="varietyPlant">Select Plant</label>
                        <select id="varietyPlant" onchange="loadVarietiesForPlant()">
                            <option value="">Choose a plant...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="varietyName">Variety Name</label>
                        <input type="text" id="varietyName" placeholder="e.g., Cherokee Purple, Genovese">
                    </div>
                    
                    <div class="form-group">
                        <label for="varietyScientific">Scientific Name (optional)</label>
                        <input type="text" id="varietyScientific" placeholder="e.g., Solanum lycopersicum 'Cherokee Purple'">
                    </div>
                    
                    <button class="btn" onclick="addVariety()">üåø Add Variety</button>
                    
                    <div id="varietyResult"></div>
                    
                    <div id="varietiesList" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let supabaseUrl = 'https://gztgrmgspbaurpyvrweq.supabase.co';
        let supabaseKey = '';

        window.addEventListener('load', function() {
            const savedUrl = localStorage.getItem('supabaseUrl');
            const savedKey = localStorage.getItem('supabaseKey');
            
            if (savedUrl) {
                document.getElementById('supabaseUrl').value = savedUrl;
                supabaseUrl = savedUrl;
            }
            if (savedKey) {
                document.getElementById('supabaseKey').value = savedKey;
                supabaseKey = savedKey;
            }
            
            if (supabaseKey) {
                loadPlantsForDropdowns();
            }
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(function(s) {
                s.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(function(n) {
                n.classList.remove('active');
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            document.querySelectorAll('.nav-item').forEach(function(item) {
                if (item.textContent.toLowerCase().includes(sectionId) || 
                    (sectionId === 'add' && item.textContent.includes('Add')) ||
                    (sectionId === 'view' && item.textContent.includes('View')) ||
                    (sectionId === 'setup' && item.textContent.includes('Setup'))) {
                    item.classList.add('active');
                }
            });
            
            if (sectionId === 'varieties') {
                loadPlantsForDropdowns();
            }
        }

        async function saveCredentials() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            
            if (!url || !key) {
                showResult('setupResult', 'Please enter both URL and API key', 'error');
                return;
            }
            
            try {
                const response = await fetch(url + '/rest/v1/all_plants?select=*&limit=1', {
                    headers: {
                        'apikey': key,
                        'Authorization': 'Bearer ' + key
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Connection failed: ' + response.status);
                }
                
                supabaseUrl = url;
                supabaseKey = key;
                
                localStorage.setItem('supabaseUrl', url);
                localStorage.setItem('supabaseKey', key);
                
                showResult('setupResult', '‚úÖ Connection successful! Credentials saved.', 'success');
                loadPlantsForDropdowns();
                
            } catch (error) {
                showResult('setupResult', '‚ùå Connection failed: ' + error.message, 'error');
            }
        }

        async function addPlant() {
            const name = document.getElementById('plantName').value.trim();
            const scientificName = document.getElementById('scientificName').value.trim();
            const isEdible = document.getElementById('isEdible').checked;
            const isFlowering = document.getElementById('isFlowering').checked;
            
            if (!name) {
                showResult('addResult', 'Please enter a plant name', 'error');
                return;
            }
            
            if (!supabaseUrl || !supabaseKey) {
                showResult('addResult', 'Please configure database connection in Setup tab first', 'error');
                return;
            }
            
            try {
                showResult('addResult', 'Adding plant...', 'loading');
                
                const plantData = {
                    common_name: name,
                    sci_name: scientificName || null,
                    edible: isEdible,
                    flowering: isFlowering
                };
                
                const response = await fetch(supabaseUrl + '/rest/v1/all_plants', {
                    method: 'POST',
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(plantData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('HTTP ' + response.status + ': ' + errorText);
                }
                
                showResult('addResult', '‚úÖ Successfully added "' + name + '" to your garden database!', 'success');
                
                document.getElementById('plantName').value = '';
                document.getElementById('scientificName').value = '';
                document.getElementById('isEdible').checked = false;
                document.getElementById('isFlowering').checked = false;
                
                loadPlantsForDropdowns();
                
            } catch (error) {
                showResult('addResult', '‚ùå Failed to add plant: ' + error.message, 'error');
            }
        }

        async function loadPlants(filter) {
            if (!supabaseUrl || !supabaseKey) {
                showResult('plantsList', 'Please configure database connection in Setup tab first', 'error');
                return;
            }
            
            try {
                showResult('plantsList', 'Loading plants...', 'loading');
                
                let url = supabaseUrl + '/rest/v1/all_plants?select=*';
                if (filter === 'edible') {
                    url += '&edible=eq.true';
                } else if (filter === 'flowering') {
                    url += '&flowering=eq.true';
                }
                
                const response = await fetch(url, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('HTTP ' + response.status + ': ' + errorText);
                }
                
                const plants = await response.json();
                
                if (plants.length === 0) {
                    showResult('plantsList', 'No plants found. Add some plants first!', 'error');
                    return;
                }
                
                let plantsHtml = '';
                plants.forEach(function(plant) {
                    plantsHtml += '<div class="plant-card">';
                    plantsHtml += '<h3>' + plant.common_name + '</h3>';
                    if (plant.sci_name) {
                        plantsHtml += '<p><em>' + plant.sci_name + '</em></p>';
                    }
                    plantsHtml += '<div class="badges">';
                    if (plant.edible) {
                        plantsHtml += '<span class="badge edible">üçΩÔ∏è Edible</span>';
                    }
                    if (plant.flowering) {
                        plantsHtml += '<span class="badge flowering">üå∏ Flowering</span>';
                    }
                    plantsHtml += '</div>';
                    plantsHtml += '</div>';
                });
                
                document.getElementById('plantsList').innerHTML = plantsHtml;
                
            } catch (error) {
                showResult('plantsList', '‚ùå Failed to load plants: ' + error.message, 'error');
            }
        }

        async function checkRawAPI() {
            if (!supabaseUrl || !supabaseKey) {
                showResult('plantsList', 'Please configure database connection in Setup tab first', 'error');
                return;
            }
            
            try {
                showResult('plantsList', 'Checking raw API...', 'loading');
                
                const url = supabaseUrl + '/rest/v1/all_plants?select=*';
                const response = await fetch(url, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey
                    }
                });
                
                let debugInfo = 'URL: ' + url + '\n';
                debugInfo += 'Status: ' + response.status + ' ' + response.statusText + '\n';
                
                const responseText = await response.text();
                debugInfo += 'Response: ' + responseText.substring(0, 500);
                
                document.getElementById('plantsList').innerHTML = '<pre style="background: #f8f9fa; padding: 12px; border-radius: 8px; font-size: 10px; overflow-x: auto; white-space: pre-wrap;">' + debugInfo + '</pre>';
                
            } catch (error) {
                showResult('plantsList', '‚ùå API check failed: ' + error.message, 'error');
            }
        }

        async function testConnection() {
            if (!supabaseUrl || !supabaseKey) {
                showResult('varietyResult', '‚ùå Missing database credentials. Please go to Setup tab first.', 'error');
                return;
            }
            
            try {
                showResult('varietyResult', 'Testing connection...', 'loading');
                
                const response = await fetch(supabaseUrl + '/rest/v1/all_plants?select=*', {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey
                    }
                });
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                
                const result = await response.json();
                showResult('varietyResult', '‚úÖ Connection successful! Found ' + result.length + ' plants.', 'success');
                
                setTimeout(function() {
                    loadPlantsForDropdowns();
                }, 1000);
                
            } catch (error) {
                showResult('varietyResult', '‚ùå Connection failed: ' + error.message, 'error');
            }
        }

        async function loadPlantsForDropdowns() {
            if (!supabaseUrl || !supabaseKey) {
                showResult('varietyResult', 'Please configure database connection in Setup tab first', 'error');
                return;
            }
            
            try {
                const response = await fetch(supabaseUrl + '/rest/v1/all_plants?select=id,common_name&order=common_name', {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey
                    }
                });
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                
                const plants = await response.json();
                
                const varietySelect = document.getElementById('varietyPlant');
                if (varietySelect) {
                    varietySelect.innerHTML = '<option value="">Choose a plant...</option>';
                    
                    if (plants.length === 0) {
                        varietySelect.innerHTML += '<option value="" disabled>No plants found</option>';
                        showResult('varietyResult', 'No plants found. Add some plants first.', 'error');
                    } else {
                        plants.forEach(function(plant) {
                            varietySelect.innerHTML += '<option value="' + plant.id + '">' + plant.common_name + '</option>';
                        });
                        showResult('varietyResult', 'Loaded ' + plants.length + ' plants successfully!', 'success');
                    }
                }
                
            } catch (error) {
                showResult('varietyResult', '‚ùå Failed to load plants: ' + error.message, 'error');
            }
        }

        async function loadVarietiesForPlant() {
            const plantId = document.getElementById('varietyPlant').value;
            if (!plantId || !supabaseUrl || !supabaseKey) {
                document.getElementById('varietiesList').innerHTML = '';
                return;
            }
            
            try {
                const response = await fetch(supabaseUrl + '/rest/v1/varieties?select=*&plant_id=eq.' + plantId, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey
                    }
                });
                
                if (response.ok) {
                    const varieties = await response.json();
                    let varietiesHtml = '<h3>Existing Varieties:</h3>';
                    
                    if (varieties.length === 0) {
                        varietiesHtml += '<p>No varieties found for this plant.</p>';
                    } else {
                        varieties.forEach(function(variety) {
                            varietiesHtml += '<div class="plant-card">';
                            varietiesHtml += '<h3>' + variety.variety_name + '</h3>';
                            if (variety.sci_name) {
                                varietiesHtml += '<p><em>' + variety.sci_name + '</em></p>';
                            }
                            varietiesHtml += '</div>';
                        });
                    }
                    
                    document.getElementById('varietiesList').innerHTML = varietiesHtml;
                }
            } catch (error) {
                document.getElementById('varietiesList').innerHTML = '<p>Failed to load varieties</p>';
            }
        }

        async function addVariety() {
            const plantId = document.getElementById('varietyPlant').value;
            const varietyName = document.getElementById('varietyName').value.trim();
            const scientificName = document.getElementById('varietyScientific').value.trim();
            
            if (!plantId || !varietyName) {
                showResult('varietyResult', 'Please select a plant and enter a variety name', 'error');
                return;
            }
            
            if (!supabaseUrl || !supabaseKey) {
                showResult('varietyResult', 'Please configure database connection first', 'error');
                return;
            }
            
            try {
                showResult('varietyResult', 'Adding variety...', 'loading');
                
                const varietyData = {
                    plant_id: parseInt(plantId),
                    variety_name: varietyName,
                    sci_name: scientificName || null
                };
                
                const response = await fetch(supabaseUrl + '/rest/v1/varieties', {
                    method: 'POST',
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': 'Bearer ' + supabaseKey,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(varietyData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error('HTTP ' + response.status + ': ' + errorText);
                }
                
                showResult('varietyResult', '‚úÖ Successfully added variety "' + varietyName + '"!', 'success');
                
                document.getElementById('varietyName').value = '';
                document.getElementById('varietyScientific').value = '';
                loadVarietiesForPlant();
                
            } catch (error) {
                showResult('varietyResult', '‚ùå Failed to add variety: ' + error.message, 'error');
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                const className = type === 'loading' ? 'result' : 'result ' + type;
                element.innerHTML = '<div class="' + className + '">' + message + '</div>';
            }
        }
    </script>
</body>
</html>
